<!DOCTYPE html>
<html lang="en-US">
<head>
<title> dashboard </title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
    font-family: Arial, sans-serif;
}
.column {
  float: left;
  width: 50%;
}
.left {
  width: 34%;
}
.right {
  width: 66%;
}

#mainTable {
  float: right;
}
tr.project {
  cursor: zoom-in;
}
th {
    font-size: 24pt;
    color: #4c7ece;
}

/* Clear floats after the columns */
.row:after {
  content: "";
  display: table;
  clear: both;
}
</style>

<body>
<div id="row">
 <div class="column left">
   <table id="mainTable">
   <th colspan="2"> dashboard </th>
   </table>
 </div>
 <div class="column right" id="details">
 </div>
</div>

<script src="https://www.gstatic.com/firebasejs/5.7.2/firebase.js"></script>
<script>
  var G = {
    "desc": { },     // place to store project descriptions
    "detailsMD": { }     // project details markdown
  };

  var icons = {
    'green': 'https://img.icons8.com/color/24/000000/ok.png',
    'yellow': 'https://img.icons8.com/color/24/000000/error.png',
    'red': 'https://img.icons8.com/color/24/000000/close-window.png',
    'todo': 'https://png.icons8.com/color/24/000000/under-construction.png',
    'working': 'https://img.icons8.com/color/24/000000/in-progress.png',
    'sleeping': 'https://img.icons8.com/color/24/000000/sleeping.png'
  };
  function iconHTML( s ) {
    return `<img src="${icons[s]}" alt="${s}">`;
  }

  function mainTable (alldocs) {
    e = document.getElementById("mainTable")  // TODO: if null
    alldocs.forEach((doc) => {
      console.log(doc.id);
      G['desc'][doc.id] = doc.data().description; 
      G['detailsMD'][doc.id] = doc.data().detailsMD; 
      let html = `<tr class="project" onclick="showDetails('${doc.id}')"> <td> ${iconHTML(doc.data().status)} </td> <td> ${doc.id} </td> </tr>`;
      e.insertAdjacentHTML( 'beforeend', html )
    });
  }
  function showDetails(p) {
    console.log(`showDetails ${p}`);
    e = document.getElementById("details");  // TODO: if null
    //let desc = ('desc' in G[p]) ? G[p]['desc'] : "";
    let desc = G['desc'][p];
    let detailsMD = G['detailsMD'][p];
    e.innerHTML = `<br><br> details of <i> ${p} </i> <br> <br> ${desc} <br> <br> ${detailsMD}`;
  }

  var config = {
    apiKey: "AIzaSyCGlXExjEJPYbPAbTrrS4EeNoSwryTL2Hc",
    authDomain: "netrcdashboard.firebaseapp.com",
    databaseURL: "https://netrcdashboard.firebaseio.com",
    projectId: "netrcdashboard",
    storageBucket: "netrcdashboard.appspot.com",
    messagingSenderId: "594095535210"
  };
  firebase.initializeApp(config);

  var fs = firebase.firestore();
  console.log("projects get");
  fs.collection('projects').get()
    .then( mainTable )
    .catch((err) => {
      console.log('Error getting documents', err);
    });
</script>

</body>

</html>
